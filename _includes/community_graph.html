{% comment %}
  Open-Source Community Building Service Card
  Interactive network graph service card for Open-Source Community Building service
  Pulls data from services.yml
{% endcomment %}

{% comment %} Find the service in services.yml {% endcomment %}
{% assign service = site.data.services | where: "id", "open-source-community-building" | first %}

{% if service %}
  {% comment %} T034: Include shared network graph function {% endcomment %}
  {% include network_graph.js %}

  {% comment %} T032: Create service card structure matching data-card format {% endcomment %}
  <article class="data-card"{% if service.id %} id="service-{{ service.id }}"{% endif %}>
    {% comment %} T033: Add canvas element in service-visual div (matching logo/icon pattern) {% endcomment %}
    <div class="service-visual">
      <canvas id="canvas-community-{{ include.id | default: 1 }}" class="network-canvas" aria-hidden="true"></canvas>
    </div>
    {% comment %} T036: Add service title using h3 (matching data-card format) {% endcomment %}
    <h3>{{ service.name }}</h3>
    {% comment %} T037: Add service description using p (matching data-card format) {% endcomment %}
    <p>{{ service.description }}</p>
    
    {% if service.url %}
      <a href="{{ service.url }}" class="service-learn-more">Learn more</a>
    {% endif %}
    
    {% if service.tags.size > 0 %}
      <div class="data-card-tags">
        {% for tag in service.tags %}
          <span class="tag">{{ tag }}</span>
        {% endfor %}
      </div>
    {% endif %}
    {% if service.featured %}
      <span class="featured-badge" aria-label="Featured">Featured</span>
    {% endif %}
    {% if service.status %}
      <span class="status-indicator status-{{ service.status | downcase }}">{{ service.status }}</span>
    {% endif %}
  </article>

  {% comment %} Canvas-specific styling only (data-card styles come from main.css) {% endcomment %}
  <style>
  .network-canvas {
    width: 100%;
    height: 180px;
    background-color: #1a1a1a;
    border-radius: calc(var(--radius) / 2);
    display: block;
    cursor: crosshair;
  }

  {% comment %} T057: Add responsive CSS media query for mobile (< 768px) {% endcomment %}
  @media (max-width: 768px) {
    .network-canvas {
      height: 150px;
    }
  }

  {% comment %} T060: Add responsive CSS media query for desktop (> 1024px) {% endcomment %}
  @media (min-width: 1025px) {
    .network-canvas {
      height: 200px;
    }
  }
  </style>

  {% comment %} T035: Add JavaScript initialization {% endcomment %}
  <script>
  (function() {
    'use strict';
    
    function initServiceCard() {
      const canvasId = 'canvas-community-{{ include.id | default: 1 }}';
      const nodeCount = 20;
      const color = '{{ service.color | default: "#60a5fa" }}'; // Blue
      
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', function() {
          createInteractiveNetwork(canvasId, nodeCount, color);
        });
      } else {
        createInteractiveNetwork(canvasId, nodeCount, color);
      }
    }
    
    initServiceCard();
  })();
  </script>
{% endif %}
